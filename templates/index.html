<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SwiftETA – AI Delivery Time Predictor</title>
  <link rel="stylesheet" href="/static/style.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    :root {
      --bg: #f8fafc;
      --card: #ffffff;
      --accent: #6366f1;
      --accent-light: #818cf8;
      --accent-dark: #4f46e5;
      --text: #0f172a;
      --text-light: #475569;
      --border: #e2e8f0;
      --shadow-sm: 0 4px 12px rgba(0,0,0,0.06);
      --shadow-md: 0 10px 30px rgba(0,0,0,0.1);
      --shadow-lg: 0 20px 60px rgba(0,0,0,0.15);
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --radius: 16px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #f0f4ff 0%, #ffffff 100%);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
    }

    .topbar {
      background: linear-gradient(135deg, var(--accent-dark), var(--accent));
      padding: 2rem 1rem;
      text-align: center;
      color: white;
      box-shadow: var(--shadow-md);
      position: relative;
      overflow: hidden;
    }

    .topbar::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 300"><path d="M0,100 Q300,200 600,100 T1000,100 L1000,300 L0,300 Z" fill="rgba(255,255,255,0.1)"/></svg>') no-repeat center bottom;
      background-size: cover;
      pointer-events: none;
    }

    .brand {
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    .brand .logo {
      font-size: 4.5rem;
      filter: drop-shadow(0 4px 10px rgba(0,0,0,0.2));
    }

    .brand h1 {
      font-size: 2.5rem;
      font-weight: 800;
      margin: 0;
      letter-spacing: -0.5px;
    }

    .brand p {
      font-size: 1.1rem;
      opacity: 0.95;
      font-weight: 500;
    }

    .main {
      max-width: 1100px;
      margin: 3rem auto;
      padding: 0 1.5rem;
    }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 2.5rem;
      box-shadow: var(--shadow-lg);
      border: 1px solid rgba(226, 232, 240, 0.5);
      backdrop-filter: blur(10px);
    }

    .form-title {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 2rem;
      color: var(--text);
      text-align: center;
      background: linear-gradient(90deg, var(--accent-dark), var(--accent-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    .group {
      display: flex;
      flex-direction: column;
    }

    .group label {
      font-weight: 600;
      color: var(--text-light);
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .group label i {
      color: var(--accent);
      font-size: 0.9em;
    }

    input, select {
      padding: 0.9rem 1rem;
      border: 1.5px solid var(--border);
      border-radius: 12px;
      font-size: 1rem;
      background: #fafbff;
      transition: all 0.25s ease;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
      background: white;
    }

    .actions {
      grid-column: 1 / -1;
      display: flex;
      justify-content: center;
      margin-top: 1.5rem;
    }

    button#predictBtn {
      padding: 1rem 3rem;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--accent-dark), var(--accent));
      color: white;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    button#predictBtn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 28px rgba(99, 102, 241, 0.4);
    }

    button#predictBtn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }

    .popup {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.7);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 1rem;
    }

    .popup.hidden { display: none; }

    .popup-card {
      width: 100%;
      max-width: 520px;
      background: white;
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow-lg);
      animation: popupRise 0.4s ease-out;
    }

    @keyframes popupRise {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .popup-header {
      background: linear-gradient(135deg, var(--accent-dark), var(--accent));
      color: white;
      padding: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .popup-header h3 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .small-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      font-size: 1.2rem;
      cursor: pointer;
      transition: 0.2s;
    }

    .small-btn:hover { background: rgba(255,255,255,0.3); }

    .popup-body {
      padding: 2rem;
      text-align: center;
    }

    .big-eta {
      font-size: 4.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--accent-dark), var(--accent-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0.5rem 0;
      line-height: 1;
    }

    .meta-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin: 2rem 0;
    }

    .meta-item {
      background: #f8f9ff;
      padding: 1rem;
      border-radius: 14px;
      border: 1px solid var(--border);
    }

    .meta-item b {
      display: block;
      color: var(--text-light);
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }

    .meta-item div {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text);
    }

    .speed-badge {
      display: inline-block;
      padding: 0.75rem 1.5rem;
      border-radius: 50px;
      font-weight: 700;
      font-size: 1.1rem;
      margin-top: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .speed-badge.fast { background: #ecfdf5; color: var(--success); border: 2px solid #bbf7d0; }
    .speed-badge.normal { background: #fffbeb; color: #92400e; border: 2px solid #fde68a; }
    .speed-badge.slow { background: #fef2f2; color: var(--danger); border: 2px solid #fca5a5; }

    @media (max-width: 768px) {
      .brand h1 { font-size: 2rem; }
      .brand .logo { font-size: 3.5rem; }
      .form-grid { grid-template-columns: 1fr; }
      .meta-grid { grid-template-columns: 1fr 1fr; }
      .big-eta { font-size: 3.8rem; }
      .card { padding: 2rem 1.5rem; }
    }

    @media (max-width: 480px) {
      .meta-grid { grid-template-columns: 1fr; }
      .popup-card { max-width: 96%; }
    }
  </style>
</head>
<body>

<div class="page">
  <header class="topbar">
    <div class="brand">
      <div class="logo">Fast Delivery</div>
      <h1>SwiftETA</h1>
      <p>AI-Powered Delivery Time Prediction</p>
    </div>
  </header>

  <main class="main">
    <section class="card form-card">
      <h2 class="form-title">Predict Delivery ETA</h2>

      <form id="etaForm" class="form-grid">
        <div class="group">
          <label><i class="fas fa-map-marker-alt"></i> Restaurant Latitude</label>
          <input name="Restaurant_latitude" type="number" step="0.0001" required />
        </div>
        <div class="group">
          <label><i class="fas fa-map-marker-alt"></i> Restaurant Longitude</label>
          <input name="Restaurant_longitude" type="number" step="0.0001" required />
        </div>

        <div class="group">
          <label><i class="fas fa-home"></i> Delivery Latitude</label>
          <input name="Delivery_location_latitude" type="number" step="0.0001" required />
        </div>
        <div class="group">
          <label><i class="fas fa-home"></i> Delivery Longitude</label>
          <input name="Delivery_location_longitude" type="number" step="0.0001" required />
        </div>

        <div class="group">
          <label><i class="fas fa-user"></i> Agent Age</label>
          <input name="Delivery_person_Age" type="number" required />
        </div>
        <div class="group">
          <label><i class="fas fa-star"></i> Agent Rating</label>
          <input name="Delivery_person_Ratings" type="number" step="0.1" required />
        </div>

        <div class="group">
          <label><i class="fas fa-tools"></i> Vehicle Condition (0-2)</label>
          <input name="Vehicle_condition" type="number" min="0" max="2" required />
        </div>
        <div class="group">
          <label><i class="fas fa-truck"></i> Multiple Deliveries</label>
          <select name="multiple_deliveries" required>
            <option value="0">No</option>
            <option value="1">Yes</option>
          </select>
        </div>

        <div class="group">
          <label><i class="fas fa-calendar"></i> Festival</label>
          <select name="Festival" required>
            <option value="No">No</option>
            <option value="Yes">Yes</option>
          </select>
        </div>
        <div class="group">
          <label><i class="fas fa-city"></i> City Type</label>
          <select name="City" required>
            <option value="Urban">Urban</option>
            <option value="Metropolitian">Metropolitan</option>
            <option value="Semi-Urban">Semi-Urban</option>
          </select>
        </div>

        <div class="group">
          <label><i class="fas fa-calendar-day"></i> Order Date</label>
          <input name="Order_Date" type="date" required />
        </div>
        <div class="group">
          <label><i class="fas fa-clock"></i> Order Time</label>
          <input name="Time_Orderd" type="time" required />
        </div>

        <div class="group">
          <label><i class="fas fa-clock"></i> Picked Time</label>
          <input name="Time_Order_picked" type="time" required />
        </div>
        <div class="group">
          <label><i class="fas fa-utensils"></i> Type of Order</label>
          <select name="Type_of_order" required>
            <option value="Snack">Snack</option>
            <option value="Drinks">Drinks</option>
            <option value="Buffet">Buffet</option>
            <option value="Meal">Meal</option>
          </select>
        </div>

        <div class="group">
          <label><i class="fas fa-biking"></i> Vehicle Type</label>
          <select name="Type_of_vehicle" required>
            <option value="motorcycle">Motorcycle</option>
            <option value="scooter">Scooter</option>
            <option value="electric_scooter">Electric Scooter</option>
          </select>
        </div>
        <div class="group">
          <label><i class="fas fa-cloud"></i> Weather</label>
          <select name="Weatherconditions" required>
            <option>Sunny</option>
            <option>Stormy</option>
            <option>Sandstorms</option>
            <option>Cloudy</option>
            <option>Fog</option>
            <option>Windy</option>
          </select>
        </div>

        <div class="group">
          <label><i class="fas fa-car"></i> Traffic Density</label>
          <select name="Road_traffic_density" required>
            <option>Low</option>
            <option>Medium</option>
            <option>High</option>
            <option>Jam</option>
          </select>
        </div>

        <div class="actions">
          <button type="submit" id="predictBtn">
            <i class="fas fa-bolt"></i> Predict ETA Now
          </button>
        </div>
      </form>
    </section>
  </main>
</div>

<div id="popup" class="popup hidden">
  <div class="popup-card">
    <div class="popup-header">
      <h3>Delivery ETA Result</h3>
      <button id="closePopup" class="small-btn">×</button>
    </div>
    <div class="popup-body">
      <div class="big-eta" id="etaMinutes">-- min</div>
      <div class="meta-grid">
        <div class="meta-item"><b>Distance</b><div id="meta_distance">-- km</div></div>
        <div class="meta-item"><b>Traffic</b><div id="meta_traffic">--</div></div>
        <div class="meta-item"><b>Weather</b><div id="meta_weather">--</div></div>
        <div class="meta-item"><b>Pickup Delay</b><div id="meta_delay">-- min</div></div>
        <div class="meta-item"><b>Speed Rule</b><div id="meta_rule_speed">--</div></div>
        <div class="meta-item"><b>AI Rating</b><div id="meta_rating">--</div></div>
      </div>
      <div class="speed-badge" id="speedBadge">Calculating...</div>
    </div>
  </div>
</div>

<script>
  const form = document.getElementById('etaForm');
  const popup = document.getElementById('popup');
  const predictBtn = document.getElementById('predictBtn');

  function showPopup(data) {
    document.getElementById('etaMinutes').innerText = Math.round(data.predicted_minutes) + ' min';
    document.getElementById('meta_distance').innerText = data.distance_km.toFixed(2) + ' km';
    document.getElementById('meta_traffic').innerText = data.traffic || '-';
    document.getElementById('meta_weather').innerText = data.weather || '-';
    document.getElementById('meta_delay').innerText = data.pickup_delay_min + ' min';
    document.getElementById('meta_rule_speed').innerText = data.speed_category_rule || '-';
    document.getElementById('meta_rating').innerText = data.speed_rating || '-';

    const badge = document.getElementById('speedBadge');
    badge.innerText = data.speed_rating;
    badge.className = 'speed-badge ' + data.speed_rating.toLowerCase();

    popup.classList.remove('hidden');
  }

  function closePopup() {
    popup.classList.add('hidden');
  }

  document.getElementById('closePopup').addEventListener('click', closePopup);
  popup.addEventListener('click', (e) => {
    if (e.target === popup) closePopup();
  });

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    predictBtn.disabled = true;
    predictBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Predicting...';

    const formData = new FormData(form);
    const payload = {};
    formData.forEach((v, k) => {
      if (k === 'Order_Date' && v) {
        const d = new Date(v);
        const dd = String(d.getDate()).padStart(2,'0');
        const mm = String(d.getMonth()+1).padStart(2,'0');
        const yyyy = d.getFullYear();
        payload[k] = `${dd}-${mm}-${yyyy}`;
      } else if ((k === 'Time_Orderd' || k === 'Time_Order_picked') && v) {
        payload[k] = v.length === 5 ? v + ':00' : v;
      } else {
        payload[k] = v;
      }
    });

    try {
      const res = await fetch('/predict_ajax', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      showPopup(data);
    } catch (err) {
      alert('Prediction failed — check server logs.');
      console.error(err);
    } finally {
      predictBtn.disabled = false;
      predictBtn.innerHTML = '<i class="fas fa-bolt"></i> Predict ETA Now';
    }
  });
</script>

</body>
</html>